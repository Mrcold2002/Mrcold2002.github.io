<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>微服务技术栈（未完）</title><meta name="description" content="菜"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="[toc]
视频地址

认识微服务
01 服务框架演变

单体架构

概念：将业务的所有功能集中在一个项目中进行开发，打成一个包部署
优点：架构简单，部署成本低
缺点：耦合度高


分布式架构

概念：根据业务功能对系统进行拆分，每个业务模块作为独立项目开发，成为一个服务
优点：降低服务耦合，有利于服务拓展升级
考虑问题：

服务拆分粒度如何？
服务集群地址如何维护？
服务之间如何实现远程调用？
服务健康状态如何感知？




微服务：是一种经过良好架构设计的分布式架构方案

微服务架构特征：

单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责，避免重复业务开发
面向服务：微服务对外暴露业务接口
自治：团队独立，技术独立，数据独立，部署独立
隔离性强：服务调用做好隔离，容错，降级，.."><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Mr_cold's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">微服务技术栈（未完）</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">认识微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#01-%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E6%BC%94%E5%8F%98"><span class="toc-text">01 服务框架演变</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#02-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94"><span class="toc-text">02 微服务技术对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#03-springcloud"><span class="toc-text">03 SpringCloud</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E4%B8%8E%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-text">服务拆分与远程调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#01-%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86"><span class="toc-text">01 服务拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#02-%E6%9C%8D%E5%8A%A1%E9%97%B4%E8%B0%83%E7%94%A8"><span class="toc-text">02 服务间调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eureka-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">Eureka 注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#01-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">01 远程调用的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#02-eureka%E5%8E%9F%E7%90%86"><span class="toc-text">02 eureka原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#03-%E6%90%AD%E5%BB%BAeurekaserver"><span class="toc-text">03 搭建EurekaServer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#04-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C"><span class="toc-text">04 服务注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"><span class="toc-text">服务发现</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/%E5%90%8E%E7%AB%AF"><i class="tag post-item-tag">后端</i></a><a href="/tags/web"><i class="tag post-item-tag">web</i></a><a href="/tags/IDEA"><i class="tag post-item-tag">IDEA</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">微服务技术栈（未完）</h1><time class="has-text-grey" datetime="2023-03-27T10:23:42.352Z">2023-03-27</time><article class="mt-2 post-content"><p>[toc]</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1LQ4y127n4/?p=1">视频地址</a></p>
<p><img src="/images/web/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88%E5%9B%BE.jpg" alt="微服务技术栈图"></p>
<h2 id="%E8%AE%A4%E8%AF%86%E5%BE%AE%E6%9C%8D%E5%8A%A1" tabindex="-1">认识微服务</h2>
<h3 id="01-%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E6%BC%94%E5%8F%98" tabindex="-1">01 服务框架演变</h3>
<ul>
<li>单体架构
<ul>
<li>概念：将业务的所有功能集中在一个项目中进行开发，打成一个包部署</li>
<li>优点：架构简单，部署成本低</li>
<li>缺点：耦合度高</li>
</ul>
</li>
<li>分布式架构
<ul>
<li>概念：根据业务功能对系统进行拆分，每个业务模块作为独立项目开发，成为一个服务</li>
<li>优点：降低服务耦合，有利于服务拓展升级</li>
<li>考虑问题：
<ul>
<li>服务拆分粒度如何？</li>
<li>服务集群地址如何维护？</li>
<li>服务之间如何实现远程调用？</li>
<li>服务健康状态如何感知？</li>
</ul>
</li>
</ul>
</li>
<li>微服务：是一种经过良好架构设计的分布式架构方案
<ul>
<li>微服务架构特征：
<ul>
<li>单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责，避免重复业务开发</li>
<li>面向服务：微服务对外暴露业务接口</li>
<li>自治：团队独立，技术独立，数据独立，部署独立</li>
<li>隔离性强：服务调用做好隔离，容错，降级，避免出现级联问题</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="02-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94" tabindex="-1">02 微服务技术对比</h3>
<ul>
<li>微服务这种方案需要技术框架来落地，国内最知名为SpringCloud和阿里巴巴的Duddo<br>
<img src="/images/web/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94.jpg" alt="微服务技术对比"></li>
</ul>
<h3 id="03-springcloud" tabindex="-1">03 SpringCloud</h3>
<ul>
<li>SpringCloud是目前全球使用最广泛的微服务框架</li>
<li>SpringCloud集成了各种微服务功能组件，并基于SpringBoot实现了这些组件的自动装配，从而提供了良好的开箱即用体验</li>
<li>SpringCloud和SpringCloud搭配使用需要注意版本兼容</li>
</ul>
<h2 id="%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E4%B8%8E%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8" tabindex="-1">服务拆分与远程调用</h2>
<h3 id="01-%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86" tabindex="-1">01 服务拆分</h3>
<ul>
<li>服务拆分注意事项
<ul>
<li>
<ol>
<li>不同微服务，不要重复开发相同业务</li>
</ol>
</li>
<li>
<ol start="2">
<li>微服务数据独立，不要访问其它微服务的数据库</li>
</ol>
</li>
<li>
<ol start="3">
<li>微服务可以将自己的业务暴露为接口，供其它微服务调用</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="02-%E6%9C%8D%E5%8A%A1%E9%97%B4%E8%B0%83%E7%94%A8" tabindex="-1">02 服务间调用</h3>
<ul>
<li>
<p>微服务调用方式</p>
<ul>
<li>基于RestTemplate发起的http请求实现远程调用</li>
<li>http请求做远程调用是与语言无关的调用，只需直到对方的ip，端口，接口路径，请求参数即可</li>
</ul>
</li>
<li>
<p>步骤：</p>
<ul>
<li>
<ol>
<li>注册RestTemplate</li>
</ol>
</li>
</ul>
<pre><code class="language-java"> @Bean
  public RestTemplate restTemplate()&#123;
      return new RestTemplate();
  &#125;
</code></pre>
<ul>
<li>
<ol start="2">
<li>服务远程调用RestTempla</li>
</ol>
</li>
</ul>
<pre><code class="language-java">  @GetMapping(&quot;&#123;orderId&#125;&quot;)
  public Order queryOrderByUserId(@PathVariable(&quot;orderId&quot;) Long orderId) &#123;
      // 1. 查询订单
      Order order=orderService.queryOrderById(orderId);
      // 2. 利用RestTemplate发起http请求，查询用户
      //(1)url路径
      String url=&quot;http://localhost:8081/user/&quot;+order.getUserId();
      //(2)发送http请求，实现远程调用
      User user=restTemplate.getForObject(url,User.class);
      // 3. 封装user到Order
      order.setUser(user);
      // 4. 返回
      return order;
  &#125;
</code></pre>
</li>
<li>
<p>服务调用关系</p>
<ul>
<li>服务提供者：暴露接口给其它微服务调用</li>
<li>服务消费者：调用其他微服务提供的接口</li>
<li>提供者和消费者角色是相对的</li>
<li>一个服务可以同时是服务提供者和消费者</li>
</ul>
</li>
</ul>
<h2 id="eureka-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83" tabindex="-1">Eureka 注册中心</h2>
<h3 id="01-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98" tabindex="-1">01 远程调用的问题</h3>
<ul>
<li>服务消费者该如何获取服务提供者的地址信息?</li>
<li>如果有多个服务者，消费者如何选择?</li>
<li>消费者如何得知服务提供者的健康状态?</li>
</ul>
<h3 id="02-eureka%E5%8E%9F%E7%90%86" tabindex="-1">02 eureka原理</h3>
<p><img src="../../images/web/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88/Eureka%E4%BD%9C%E7%94%A8%E5%9B%BE.jpg" alt></p>
<ul>
<li>
<p>服务消费者该如何获取服务提供者的地址信息?</p>
<ul>
<li>服务提供者启动时向eureka注册自己的信息</li>
<li>eureka保存这些信息</li>
<li>消费者根据服务名称向eureka拉取提供者信息</li>
</ul>
</li>
<li>
<p>如果有多个服务者，消费者如何选择?</p>
<ul>
<li>服务消费者利用负载均衡算法选择一个执行</li>
</ul>
</li>
<li>
<p>消费者如何得知服务提供者的健康状态?</p>
<ul>
<li>服务提供者每30s向eurekaServer发送心跳请求，报告健康状态</li>
<li>eureeure</li>
</ul>
</li>
<li>
<p>在Eureka架构中，微服务角色有两类</p>
<ul>
<li>EurekaServer：服务端，注册中心
<ul>
<li>记录服务信息，心跳监控</li>
</ul>
</li>
<li>EureClient：客户端
<ul>
<li>Provider：服务提供者
<ul>
<li>注册自己的信息到EurekaServer</li>
<li>每隔30s向EurekaServer发送心跳</li>
</ul>
</li>
<li>consumer：服务消费者
<ul>
<li>根据服务名称从EurekaServer拉取服务列表</li>
<li>基于服务列表做负载均衡，选中一个微服务后发起远程调用</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="03-%E6%90%AD%E5%BB%BAeurekaserver" tabindex="-1">03 搭建EurekaServer</h3>
<ul>
<li>搭建步骤
<ul>
<li>
<ol>
<li>创建项目，引入依赖</li>
</ol>
</li>
</ul>
<pre><code class="language-xml">&lt;dependency&gt;
      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;
  &lt;/dependency&gt;
</code></pre>
<ul>
<li>
<ol start="2">
<li>编写启动类，添加@EnableEurekaServer注解</li>
</ol>
</li>
</ul>
<pre><code class="language-java">  @EnableEurekaServer
  @SpringBootApplication
  public class EurekaApplication &#123;
  public static void main(String[] args) &#123;
      SpringApplication.run(EurekaApplication.class,args);
      &#125;
  &#125;
</code></pre>
<ul>
<li>
<ol start="3">
<li>添加application.yml文件，编写配置</li>
</ol>
</li>
</ul>
<pre><code class="language-yaml">  server:
      port: 10086
  spring:
      application:
          name: eurekaserver #eureka服务名称
  eureka:
      client:
          service-url:
              defaultZone: http://127.0.0.1:10086/eureka
</code></pre>
</li>
</ul>
<h3 id="04-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C" tabindex="-1">04 服务注册</h3>
<ul>
<li>步骤如下：
<ul>
<li>
<ol>
<li>在user-service项目引入<code>spring-cloud-starter-netflix-eureka-client</code>的依赖</li>
</ol>
</li>
</ul>
<pre><code class="language-xml">  &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
  &lt;/dependency&gt;
</code></pre>
<ul>
<li>
<ol start="2">
<li>在<code>application.yml</code>文件，编写下面配置</li>
</ol>
</li>
</ul>
<pre><code class="language-yaml">  server:
      port: 10086
  spring:
      application:
          name: eurekaclient #eureka服务名称
  eureka:
      client:
          service-url:
              defaultZone: http://127.0.0.1:10086/eureka
</code></pre>
</li>
</ul>
<h3 id="%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0" tabindex="-1">服务发现</h3>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2023/03/22/git%E5%AD%A6%E4%B9%A0/" title="git学习"><span class="has-text-weight-semibold">Next: git学习</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Mrcold2002"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Mr_cold 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>