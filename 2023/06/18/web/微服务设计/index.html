<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>微服务设计</title><meta name="description" content="菜"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="[toc]
本文章为阅读这 微服务设计[美]Sam Newman 一书籍的读书笔记
第1章 微服务
1.1 什么是微服务
微服务就是一些协同工作的小而自治的服务
1.1.1 很小，专注于做好一件事


单一职责原则：把因相同原因而变化的东西聚合在一起，把因不同原因而变化的东西分离开来（Robert C.Martin）

在代码层面：代码的内聚性
在服务层面：微服务



服务越小，微服务架构的优点和缺点也越明显

服务越小，带来的独立性的好处多但管理大量服务也会越复杂



1.1.2 自治性

一个微服务就是一个独立的实体。它可以独立地部署在PAAS上，也可以作为一个操作系统进程存在。
但我们应该尽量避免把多个服务部署到同一个机器上，尽管这种隔离性会引发一些代价，但它能够大大简化分布式系统的构建
服务之间.."><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Mr_cold's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">微服务设计</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">第1章 微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1.1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.1 什么是微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1.1.1-%E5%BE%88%E5%B0%8F%EF%BC%8C%E4%B8%93%E6%B3%A8%E4%BA%8E%E5%81%9A%E5%A5%BD%E4%B8%80%E4%BB%B6%E4%BA%8B"><span class="toc-text">1.1.1 很小，专注于做好一件事</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.1.2-%E8%87%AA%E6%B2%BB%E6%80%A7"><span class="toc-text">1.1.2 自治性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1.2-%E4%B8%BB%E8%A6%81%E5%A5%BD%E5%A4%84"><span class="toc-text">1.2 主要好处</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.1-%E6%8A%80%E6%9C%AF%E5%BC%82%E6%9E%84%E5%9E%8B"><span class="toc-text">1.2.1 技术异构型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.2-%E5%BC%B9%E6%80%A7"><span class="toc-text">1.2.2 弹性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.3-%E6%89%A9%E5%B1%95"><span class="toc-text">1.2.3 扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.4-%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-text">1.2.4 简化部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.5-%E4%B8%8E%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%8C%B9%E9%85%8D"><span class="toc-text">1.2.5 与组织架构相匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.6-%E5%8F%AF%E7%BB%84%E5%90%88%E6%80%A7"><span class="toc-text">1.2.6 可组合性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.2.7-%E5%AF%B9%E5%8F%AF%E6%9B%BF%E4%BB%A3%E6%80%A7%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-text">1.2.7 对可替代性的优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1.3-%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="toc-text">1.3 面向服务的架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1.4-%E5%85%B6%E4%BB%96%E5%88%86%E8%A7%A3%E6%8A%80%E6%9C%AF"><span class="toc-text">1.4 其他分解技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1.4.1-%E5%85%B1%E4%BA%AB%E5%BA%93%E6%8A%80%E6%9C%AF"><span class="toc-text">1.4.1 共享库技术</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1.4.2-%E6%A8%A1%E5%9D%97"><span class="toc-text">1.4.2 模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1.5-%E6%B2%A1%E6%9C%89%E9%93%B6%E5%BC%B9-&-1.6-%E5%B0%8F%E7%BB%93"><span class="toc-text">1.5 没有银弹 &amp; 1.6 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E6%BC%94%E5%8C%96%E5%BC%8F%E6%9E%B6%E6%9E%84%E5%B8%88"><span class="toc-text">第2章 演化式架构师</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1"><i class="tag post-item-tag">微服务</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">微服务设计</h1><time class="has-text-grey" datetime="2023-06-18T14:42:00.451Z">2023-06-18</time><article class="mt-2 post-content"><p>[toc]<br>
本文章为阅读这 微服务设计[美]Sam Newman 一书籍的读书笔记</p>
<h2 id="%E7%AC%AC1%E7%AB%A0-%E5%BE%AE%E6%9C%8D%E5%8A%A1" tabindex="-1">第1章 微服务</h2>
<h3 id="1.1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1" tabindex="-1">1.1 什么是微服务</h3>
<p>微服务就是一些协同工作的小而自治的服务</p>
<h4 id="1.1.1-%E5%BE%88%E5%B0%8F%EF%BC%8C%E4%B8%93%E6%B3%A8%E4%BA%8E%E5%81%9A%E5%A5%BD%E4%B8%80%E4%BB%B6%E4%BA%8B" tabindex="-1">1.1.1 很小，专注于做好一件事</h4>
<ul>
<li>
<p>单一职责原则：把因相同原因而变化的东西聚合在一起，把因不同原因而变化的东西分离开来（Robert C.Martin）</p>
<ul>
<li>在代码层面：代码的内聚性</li>
<li>在服务层面：微服务</li>
</ul>
</li>
<li>
<p>服务越小，微服务架构的优点和缺点也越明显</p>
<ul>
<li>服务越小，带来的独立性的好处多但管理大量服务也会越复杂</li>
</ul>
</li>
</ul>
<h4 id="1.1.2-%E8%87%AA%E6%B2%BB%E6%80%A7" tabindex="-1">1.1.2 自治性</h4>
<ul>
<li>一个微服务就是一个独立的实体。它可以独立地部署在PAAS上，也可以作为一个操作系统进程存在。</li>
<li>但我们应该尽量避免把多个服务部署到同一个机器上，尽管这种隔离性会引发一些代价，但它能够大大简化分布式系统的构建</li>
<li>服务之间均通过网络调用进行通信，从而加强服务之间的隔离性，避免紧耦合</li>
<li>服务会暴露出API（Application Programming Interface 应用编程接口），然后服务之间通过这些API进行通信。API的实现技术应该避免和消费方耦合。</li>
<li>为了达到解耦的目的，需要正确地建模服务和API</li>
</ul>
<h3 id="1.2-%E4%B8%BB%E8%A6%81%E5%A5%BD%E5%A4%84" tabindex="-1">1.2 主要好处</h3>
<h4 id="1.2.1-%E6%8A%80%E6%9C%AF%E5%BC%82%E6%9E%84%E5%9E%8B" tabindex="-1">1.2.1 技术异构型</h4>
<ul>
<li>
<p>在多服务协作的系统中，可以在不同的服务中使用最适合该服务的技术，尝试使用一种适用所有场景的标准化技术，会使所有场景都得不到好的支持</p>
<ul>
<li>例如：不同服务可以使用不同的数据库<img src="/images/web/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/1-1.jpg" alt></li>
</ul>
</li>
<li>
<p>微服务可以帮助我们更快地采用新技术，并且理解到新技术地好处</p>
</li>
<li>
<p>为了同时使用多种技术，会付出代价，比如一些组织会限制语言的选择，比如网飞和推特地技术基于JVM</p>
</li>
<li>
<p>贯穿本书地一个问题：微服务如何寻找平衡</p>
<ul>
<li>第2章将会讨论如何做技术选择，其中主要专注于演进式架构</li>
<li>第4章主要关注继承，将讨论如何避免服务间的过度耦合，从而可以彼此独立地进行技术演化</li>
</ul>
</li>
</ul>
<h4 id="1.2.2-%E5%BC%B9%E6%80%A7" tabindex="-1">1.2.2 弹性</h4>
<ul>
<li>在单块服务系统中，如果服务不可用，那么所有功能不可用。
<ul>
<li>可以通过将同样的实例运行到不同地机器上来降低功能完全不可用的概率</li>
</ul>
</li>
<li>然而微服务系统本身就能很好地处理服务的不可用和功能降级问题</li>
</ul>
<h4 id="1.2.3-%E6%89%A9%E5%B1%95" tabindex="-1">1.2.3 扩展</h4>
<ul>
<li>庞大的单体服务，即便只有一小部分存在性能问题，也需要对整个服务进行扩展，如果使用较小的多个服务，则可以只对需要扩展的服务进行扩展</li>
</ul>
<h4 id="1.2.4-%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2" tabindex="-1">1.2.4 简化部署</h4>
<ul>
<li>单体服务中，部署频率低，意味着两次发布之间软件有很多的功能增强，此时两次发布之间的差异越大，出错的机率越高</li>
<li>微服务架构中，各个服务的部署是独立的，可以针对特定服务进行单个部署。如果真出了问题，只影响一个服务，且容易回滚</li>
</ul>
<h4 id="1.2.5-%E4%B8%8E%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%8C%B9%E9%85%8D" tabindex="-1">1.2.5 与组织架构相匹配</h4>
<ul>
<li>微服务架构可以很好地将架构和组织架构相匹配，避免出现过大地代码库，从而获得理想的团队大小和生产力，服务的所有权也更好地可以在团队之间迁移，从而避免异地团队地出现。</li>
</ul>
<h4 id="1.2.6-%E5%8F%AF%E7%BB%84%E5%90%88%E6%80%A7" tabindex="-1">1.2.6 可组合性</h4>
<ul>
<li>在微服务架构中，根据不同的目的，人们可以通过不同的方式使用同一个功能，在考虑用户如何使用该软件时这一点尤为重要。</li>
<li>单纯考虑桌面网站或移动应用程序的时代已经过去了，现在需要考虑的程序种类有 Web，原生应用，移动端Web，平板应用以及可穿戴设备等</li>
<li>因此针对每一种程序都需要考虑已有功能组合来实现这些应用</li>
<li>在微服务架构中，系统会提供很多接缝供外部使用，当情况发生变化时，可以使用不同的方式构建应用，而整体化应用程序只能提供一个非常粗粒度的接缝供外部使用</li>
</ul>
<h4 id="1.2.7-%E5%AF%B9%E5%8F%AF%E6%9B%BF%E4%BB%A3%E6%80%A7%E7%9A%84%E4%BC%98%E5%8C%96" tabindex="-1">1.2.7 对可替代性的优化</h4>
<ul>
<li>历史遗留系统，可能使用Fortran变体编写，且运行在几十年前就应该被淘汰的硬件上，但以为工作量大，而且风险很高，至今仍在运行</li>
<li>而在微服务架构中，可以轻易地重写服务或删除不再使用的服务</li>
</ul>
<h3 id="1.3-%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9E%B6%E6%9E%84" tabindex="-1">1.3 面向服务的架构</h3>
<ul>
<li>
<p>SOA（Service-Oriented Architecture，面向服务的架构）是一种设计方法，其中包含多个服务，而服务之间通过配合最终会提供一系列功能。</p>
</li>
<li>
<p>一个服务通常以独立的形式存在于操作系统进程中，服务之间通过网络调用，而非采用进程内调用的方式进行通信</p>
</li>
<li>
<p>实施SOA时会遇到很多问题</p>
<ul>
<li>通讯协议(如SOAP)如何选择</li>
<li>第三方中间件如何选择</li>
<li>服务粒度如何确定</li>
</ul>
</li>
<li>
<p>就像认为XP或者Scrum是敏捷软件开发的一种方法一样，微服务架构也可以是SOA的一种特定方式</p>
</li>
</ul>
<h3 id="1.4-%E5%85%B6%E4%BB%96%E5%88%86%E8%A7%A3%E6%8A%80%E6%9C%AF" tabindex="-1">1.4 其他分解技术</h3>
<ul>
<li>基于微服务架构主要有两个优势
<ul>
<li>
<ol>
<li>具有较小的粒度</li>
</ol>
</li>
<li>
<ol start="2">
<li>能够在解决问题的方法上给予你更多的选择</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="1.4.1-%E5%85%B1%E4%BA%AB%E5%BA%93%E6%8A%80%E6%9C%AF" tabindex="-1">1.4.1 共享库技术</h4>
<ul>
<li>基本上所有的语言都支持将整个代码库分解为多个库，这是一种非常标准的分解技术，库可以由第三方或者自己组织提供</li>
<li>存在缺点：
<ul>
<li>
<ol>
<li>无法选择异构的技术</li>
</ol>
<ul>
<li>一般来讲，一种库中只能存在一种语言，或者至少在同一个平台上使用</li>
</ul>
</li>
<li>
<ol start="2">
<li>会失去独立地对系统某一部分进行扩展的能力，除非是用的是动态链接库，否则每次当库有更新的时候，都需要重新部署整个进程</li>
</ol>
</li>
<li>
<ol start="3">
<li>最糟糕的影响：缺少一个比较明显的接缝来建立架构的安全性保护措施，从而无法保证系统的弹性</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="1.4.2-%E6%A8%A1%E5%9D%97" tabindex="-1">1.4.2 模块</h4>
<ul>
<li>有些语言提供了模块分解技术，允许对模块进行生命周期管理，这样就可以把模块部署到运行的进程中，并且可以在不停止整个进程的前提下对某个模块进行更改</li>
<li>模块分解技术
<ul>
<li>OSGI（Open Source Gateway Initiative,开放服务网关协议）</li>
<li>Erlang</li>
</ul>
</li>
<li>缺点与共享库类似：大大限制我们采用新技术和独立队服务进行扩展的能力，且有可能会导致使用过度耦合的集成技术，同时也缺乏相应的接缝来进行架构的安全性保护</li>
</ul>
<h3 id="1.5-%E6%B2%A1%E6%9C%89%E9%93%B6%E5%BC%B9-%26-1.6-%E5%B0%8F%E7%BB%93" tabindex="-1">1.5 没有银弹 &amp; 1.6 小结</h3>
<ul>
<li>微服务不是免费的午餐，更不是银弹，如果你想要得到一条通用准则，那么微服务是一个错误的决定</li>
<li>到目前为止，已经了解到
<ul>
<li>什么是微服务</li>
<li>微服务和其他组合技术有什么不同</li>
<li>微服务的好处</li>
</ul>
</li>
<li>后续将讨论如何得到这些好处及如何避免一些常见的陷阱</li>
</ul>
<h2 id="%E7%AC%AC2%E7%AB%A0-%E6%BC%94%E5%8C%96%E5%BC%8F%E6%9E%B6%E6%9E%84%E5%B8%88" tabindex="-1">第2章 演化式架构师</h2>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2023/06/18/web/%E5%9B%BE%E8%A7%A3HTTP/" title="图解HTTP"><span class="has-text-weight-semibold">Next: 图解HTTP</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Mrcold2002"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Mr_cold 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>